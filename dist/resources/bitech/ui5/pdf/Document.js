sap.ui.define(["sap/ui/core/Control","sap/ui/unified/FileUploader","mozilla/pdfjs/build/pdf.min","bitech/ui5/pdf/Page"],function(e,t,i,r){"use strict";return e.extend("bitech.ui5.pdf.Document",{metadata:{properties:{scale:"float",src:"string",noDataText:"string",page:{type:"int",defaultValue:1},pageCount:"int"},aggregations:{_pages:{type:"bitech.ui5.pdf.Page",multiple:true,visibillity:"hidden"},_previewPages:{type:"bitech.ui5.pdf.Page",multiple:true,visibillity:"hidden"}},events:{documentLoaded:{},drawn:{},pageSelected:{}}},init:function(){},onPageClick:function(e){var t=this.getAggregation("_previewPages"),i=e.getSource();this.setPage(i.getNumber());t.forEach(function(e){if(e!=i){e.removeStyleClass("bitechUi5PdfSelected")}})},setPage:function(e){this.setProperty("page",e,true);var t=this.getAggregation("_pages");if(e<1||e>t.length){throw new Error("PageNumberIsOutOfRange")}var i=t[e-1],r=i.getDomRef();r.scrollIntoView();this.fireEvent("pageSelected")},loadDocument:function(e){this.setBusy(true);var t=sap.ui.getCore(),i=t.getLibraryResourceBundle("mozilla.pdfjs"),a;a=i.oUrlInfo.url.replace("messagebundle.properties","");pdfjsLib.GlobalWorkerOptions.workerSrc=a+"build/pdf.worker.min.js";pdfjsLib.getDocument(this.getSrc()).promise.then(function(e){var t,i;this.setPageCount(e.numPages);this.fireEvent("documentLoaded");for(var a=1;a<=e.numPages;++a){t=new r;i=new r;t.setBusy(true);i.setBusy(true);if(a===1){t.attachEvent("scaleDetermined",function(e){this.setProperty("scale",e.getParameter("scale"),true)}.bind(this))}this.addAggregation("_pages",t);this.addAggregation("_previewPages",i);i.attachEvent("click",this.onPageClick.bind(this));t.setPage(e,a);i.setPage(e,a);if(a===e.numPages){t.attachEvent("drawn",null,function(){this.setBusy(false);this.fireEvent("drawn")}.bind(this))}}}.bind(this),function(e){throw new Error(e)})},renderer:function(e,t){e.write("<div ");e.writeControlData(t);e.addClass("bitechUi5PdfDocument");e.writeClasses();e.write(">");if(t.getAggregation("_previewPages")){e.write("<aside ");e.addClass("bitechUi5PdfPreview");e.writeClasses();e.write(">");t._renderPages(e,t,"_previewPages");e.write("</aside>")}if(t.getAggregation("_pages")){e.write("<div ");e.addClass("bitechUi5PdfPages");e.writeClasses();e.write(">");t._renderPages(e,t,"_pages");e.write("</div>")}if(t.getNoDataText()&&!t.getAggregation("_pages")){e.write("<div ");e.addClass("sapMListNoData");e.writeClasses();e.write(">");e.write(t.getNoDataText());e.write("</div>")}e.write("</div>")},setSrc:function(e){if(e!==this.getSrc()){this.setProperty("src",e,false);this.removeAllAggregation("_pages");this.removeAllAggregation("_previewPages");if(e){this.loadDocument(e)}}},_renderPages:function(e,t,i){if(t.getAggregation(i)){t.getAggregation(i).forEach(function(t){e.renderControl(t)})}}})});